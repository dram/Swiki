| survey sumVotes maxVotes votes return toFiles length |survey _ request settingsAt: 'survey'."Get maxVotes and sumVotes"sumVotes _ survey sumVotes.maxVotes _ survey maxVotes.return _ WriteStream on: String new."Header Row"toFiles _ book formatBookAction: 'toFiles' request: request response: response shelf: shelf.return	nextPutAll: '<table border=0 cellpadding=0 cellspacing=0>';	nextPutAll: String crlf;	nextPutAll: '<tr><td>&nbsp;</td><td align=center>&nbsp;<em>#</em>&nbsp;</td><td><em>percentage</em></td></tr>';	nextPutAll: String crlf;	nextPutAll: '<tr><td colspan=3 bgcolor="#000000"><img width=1 height=1 src="';	nextPutAll: toFiles;	nextPutAll: 'blank.gif" alt=""></td></tr>';	nextPutAll: String crlf."Add Rows"survey results do: [:arr |	votes _ arr at: 2.	length _ (maxVotes = 0)		ifTrue: [0]		ifFalse: [200 * votes // maxVotes].	return		nextPutAll: '<tr><td align=right>&nbsp;<em>';		nextPutAll: (TextFormatter encodeToXmlCrlf: (arr at: 1));		nextPutAll: '</em></td><td align=right>&nbsp;';		nextPutAll: votes asString;		nextPutAll: '&nbsp;</td><td background="';		nextPutAll: toFiles;		nextPutAll: 'graphback.gif">'.	(length = 0)		ifTrue: [return nextPutAll: '&nbsp;0.0&nbsp;%']		ifFalse: [			return				nextPutAll: '<img src="';				nextPutAll: toFiles;				nextPutAll: 'graphbar.gif" alt="-'.			(length // 30) timesRepeat: [return				nextPut: $-].			return				nextPutAll: '" width=';			nextPutAll: length asString;			nextPutAll: ' height=5 border=1>&nbsp;';			nextPutAll: ((1000 * votes asFloat / sumVotes) asInteger asFloat / 10) asString;			nextPutAll: '&nbsp;%'].	return		nextPutAll: '</td></tr>';		nextPutAll: String crlf].return	nextPutAll: '<tr><td colspan=3 bgcolor="#000000"><img width=1 height=1 src="';	nextPutAll: toFiles;	nextPutAll: 'blank.gif" alt=""></td></tr>';	nextPutAll: String crlf;	nextPutAll: '<tr><td align=right>&nbsp;total</td><td align=right>&nbsp;';	nextPutAll: sumVotes asString;	nextPutAll: '&nbsp;</td>'.survey hasRange	ifTrue: [return		nextPutAll: '<td align=right>&nbsp;average&nbsp;';		nextPutAll: survey averageString]	ifFalse: [return		nextPutAll: '<td>'].return	nextPutAll: '&nbsp;</td></tr>';	nextPutAll: String crlf;	nextPutAll: '</table>';	contents