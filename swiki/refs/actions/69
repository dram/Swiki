| dir colorScheme return img ref containingDir last |dir _ request settingsAt: 'dir'.colorScheme _ book modulesAt: 'colorScheme'.return _ WriteStream on: (String new: 1000)."Begin Table"return	nextPutAll: '<table border=0 cellpadding=2 cellspacing=0>';	nextPutAll: String crlf;	nextPutAll: '<tr><td></td><td><em>name</em></td><td align=right>&nbsp;&nbsp;<em>size</em></td><td align=right>&nbsp;&nbsp;<em>date</em></td></tr>';	nextPutAll: String crlf;	nextPutAll: '<tr><td colspan=4><hr size=1 noshade></td></tr>';	nextPutAll: String crlf."Add Super Directory"(dir isASubDirectory) ifTrue: [	containingDir _ dir containingDirectory.	img _ colorScheme mime: 'folder' alt: 'up one level'.	ref _ (request referenceShelf: shelf book: book address: 'uploads/'), containingDir httpPath.	return		nextPutAll: '<tr><td><a href="';		nextPutAll: ref;		nextPutAll: '">';		nextPutAll: img;		nextPutAll: '</a></td><td><em><a href="';		nextPutAll: ref;		nextPutAll: '">up one level</a></em></td><td align="right">&nbsp;&nbsp;';		nextPutAll: containingDir size asString;		nextPutAll: '</td><td align="right">&nbsp;&nbsp;';		nextPutAll: (NuSwikiPage printDate: containingDir modificationDate);		nextPutAll: '</td></tr>';		nextPutAll: String crlf]."Add Sub Directories"dir directoriesAlphabetically do: [:subDir |	img _ colorScheme mime: 'folder' alt: (subDir strictXmlName).	ref _ (request referenceShelf: shelf book: book address: 'uploads/'), subDir httpPath.	return		nextPutAll: '<tr><td><a href="';		nextPutAll: ref;		nextPutAll: '">';		nextPutAll: img;		nextPutAll: '</a></td><td><a href="';		nextPutAll: ref;		nextPutAll: '">';		nextPutAll: subDir xmlName;		nextPutAll: '</a></td><td align="right">&nbsp;&nbsp;';		nextPutAll: subDir size asString;		nextPutAll: '</td><td align="right">&nbsp;&nbsp;';		nextPutAll: (NuSwikiPage printDate: subDir modificationDate);		nextPutAll: '</td></tr>';		nextPutAll: String crlf]."Add Files"dir filesAlphabetically do: [:versions |	last _ versions last.	img _ colorScheme mime: (versions mimeType copyUpTo: $/) alt: (versions strictXmlName).	ref _ (book settingsAt: 'uploadServerPath'), dir httpPath, last httpName.	return		nextPutAll: '<tr><td><a href="';		nextPutAll: ref;		nextPutAll: '">';		nextPutAll: img;		nextPutAll: '</a></td><td><a href="';		nextPutAll: ref;		nextPutAll: '">';		nextPutAll: versions xmlName;		nextPutAll: '</a>'.	(versions size > 1) ifTrue: [return		nextPutAll: '&nbsp;(<a href="';		nextPutAll: (request referenceShelf: shelf book: book address: 'uploads/');		nextPutAll: dir httpPath;		nextPutAll: last httpName;		nextPutAll: '?history=true">r';		nextPutAll: versions size asString;		nextPutAll: '</a>)'].	return		nextPutAll:  '</td><td align=right>&nbsp;&nbsp;';		nextPutAll: last fileSizeInWords;		nextPutAll: '</td><td align=right>&nbsp;&nbsp;';		nextPutAll: (NuSwikiPage printDate: last modificationDate);		nextPutAll: '</td></tr>';		nextPutAll: String crlf]."End Table and Return Result"return	nextPutAll: '</table>';	contents