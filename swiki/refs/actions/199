| options url max error document expire |options _ request settingsAt: 'options'.error _ nil."Get option fields: src, max, and expire"(url _ options at: 'src' ifAbsent: [nil]) ifNil: [	error _ '<b>RSS function must have a <em>src</em> field.</b>'].error ifNil: [	max _ options at: 'max' ifAbsent: ['0'].	(max isAllDigits)		ifTrue: [max _ max asInteger]		ifFalse: [error _ '<b>RSS function <em>max</em> field must be an integer.</b>']].error ifNil: [	expire _ options at: 'expire' ifAbsent: ['12'].	(expire isAllDigits)		ifTrue: [expire _ expire asInteger]		ifFalse: [error _ '<b>RSS function <em>expire</em> field must be an integer.</b>']]."Get the corresponding RSS document"error ifNil: [	document _ (shelf modulesAt: 'rss') rssAtUrl: url expireHours: expire.	(document isKindOf: RSSDocument) ifFalse: [document caseOf: {		[#httpGetFailed]->[error _ '<b>RSS function unable to contact <em>', (TextFormatter encodeToXmlCrlf: url),'</em>.</b>'].		[#xmlParseFailed]->[error _ '<b>RSS function found ill-formed XML at <em>src</em> field.</b>'].		[#xmlToRssFailed]->[error _ '<b>RSS function is unable to parse XML at <em>src</em> field.</b>']}]].error	ifNil: [String streamContents: [:stream |		"Display the RSS document"		stream			nextPutAll: '<table border=0 cellpadding=2 cellspacing=0>';			nextPutAll: String crlf;			nextPutAll: '<tr><td><b><a class="external" href="';			nextPutAll: (document link);			nextPutAll: '">';			nextPutAll: (document title);			nextPutAll: '</a>: ';			nextPutAll: (document description);			nextPutAll: '</b></td></tr>';			nextPutAll: String crlf;			nextPutAll: '<tr><td><hr size=1 noshade></td></tr>';			nextPutAll: String crlf.		document itemsMax: max do: [:title :link :description :creator :date |			stream				nextPutAll: '<tr><td><a class="external" href="';				nextPutAll: link;				nextPutAll: '">';				nextPutAll: title;				nextPutAll: '</a>'.			(creator isNil or: [date isNil]) ifFalse: [stream				nextPutAll: ' (';				nextPutAll: creator;				nextPutAll: ', ';				nextPutAll: (NuSwikiPage printDate: date);				nextPutAll: ')'].			description ifNotNil: [stream				nextPutAll: ': ';				nextPutAll: description].			stream				nextPutAll: '</td></tr>';				nextPutAll: String crlf].		stream			nextPutAll: '</table>']]	ifNotNil: [error]