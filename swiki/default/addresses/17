| files path fs |files _ shelf modulesAt: 'files'.fs _ (request fieldsAsBooleanKey: 'history' ifAbsent: [false])	ifTrue: [shelf modulesAt: 'fileHistoryServer']	ifFalse: [shelf modulesAt: 'fileServer'].(path _ request raw url) caseOf: {	['']->["Forward to /"		response			at: 'headerStatus' put: #tempMoved;			at: 'location' put: '/'.		shelf formatShelfTemplate: 'toDir' request: request response: response].	['/']->[(files fileRefsExists: 'index.html')		ifTrue: ["Serve index.html"			files servePath: 'index.html' fs: fs options: (Dictionary new at: 'request' put: request; at: 'response' put: response; yourself)]		ifFalse: ["Serve list of swiki"			shelf formatPrivAddress: 'list' request: request response: response]].	['/robots.txt']->[(shelf settingsAt: 'allowRobots')		ifTrue: [files servePath: 'robots.txt' fs: fs options: (Dictionary new at: 'request' put: request; at: 'response' put: response; yourself)]		ifFalse: [response at: 'contentType' put: (MIMEDocument contentTypePlainText).			shelf formatShelfTemplate: 'robots' request: request response: response]]}	otherwise: ["Serve as files"		(shelf modulesAt: 'files') servePath: (path copyFrom: 2 to: path size) fs: fs options: (Dictionary new at: 'request' put: request; at: 'response' put: response; yourself)]