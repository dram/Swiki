| colorScheme dir prefix return img ref containingDir last |colorScheme _ shelf modulesAt: 'colorScheme'.dir _ request settingsAt: 'dir'.prefix _ request settingsAt: 'prefix'.return _ WriteStream on: (String new: 1000)."Begin Table"return nextPutAll: ('<table border=0 cellpadding=2 cellspacing=0>', String crlf, '<tr><td></td><td><em>name</em></td><td align=right>&nbsp;&nbsp;<em>size</em></td><td align=right>&nbsp;&nbsp;<em>date</em></td></tr>', String crlf, '<tr><td colspan=4><hr size=1 noshade></td></tr>', String crlf)."Add Super Directory"(dir isASubDirectory) ifTrue: [	containingDir _ dir containingDirectory.	img _ colorScheme mime: 'folder' alt: 'up one level'.	ref _ prefix, containingDir httpPath.	return nextPutAll: ('<tr><td><a href="', ref, '">', img, '</a></td><td><em><a href="', ref, '">up one level</a></em></td><td align="right">&nbsp;&nbsp;', containingDir size asString, '</td><td align="right">&nbsp;&nbsp;', (NuSwikiPage printDate: containingDir modificationDate), '</td></tr>', String crlf)]."Add Sub Directories"dir directoriesAlphabetically do: [:subDir |	img _ colorScheme mime: 'folder' alt: subDir strictXmlName.	ref _ prefix, subDir httpPath.	return nextPutAll: ('<tr><td><a href="', ref, '">', img, '</a></td><td><a href="', ref, '">', subDir xmlName, '</a></td><td align="right">&nbsp;&nbsp;', subDir size asString, '</td><td align="right">&nbsp;&nbsp;', (NuSwikiPage printDate: subDir modificationDate), '</td></tr>', String crlf)]."Add Files"dir filesAlphabetically do: [:versions |	last _ versions last.	img _ colorScheme mime: (last mimeType copyUpTo: $/) alt: (versions strictXmlName).	ref _ prefix, dir httpPath, last httpName.	return nextPutAll: ('<tr><td><a href="', ref, '">', img, '</a></td><td><a href="', ref, '">', versions xmlName, '</a>').	(versions size > 1) ifTrue: [return		nextPutAll: '&nbsp;(<a href="';		nextPutAll: ref;		nextPutAll: '?history=true">r';		nextPutAll: versions size asString;		nextPutAll: '</a>)'].	return nextPutAll: ('</td><td align=right>&nbsp;&nbsp;', last fileSizeInWords, '</td><td align=right>&nbsp;&nbsp;', (NuSwikiPage printDate: last modificationDate), '</td></tr>', String crlf)]."End Table and Return Result"return	nextPutAll: '</table>';	contents