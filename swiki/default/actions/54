| values addresses test |values _ book formatPrivAddress: 'settings' request: request response: response shelf: shelf.addresses _ OrderedCollection new.book forbidWriting.values do: [:value | (value class = Array) ifTrue: [	((book hasParent) and: [book parent settingsIncludes: (value at: 1)])		ifTrue: [(book rawSettingsIncludes: (value at: 1))			ifTrue: [(request fieldsAsBooleanKey: ('inherit-', (value at: 1)))				ifTrue: ["Remove Override"					book rawSettingsRemove: (value at: 1).					(value at: 5) ifNotNil: [(addresses includes: (value at: 5))						ifFalse: [addresses add: (value at: 5)]]]				ifFalse: ["Change to Request Value"					((value at: 3) isKindOf: String)						ifTrue: [test _ request fieldsKey: (value at: 1)]						ifFalse: [test _ request fieldsAsBooleanKey: (value at: 1)].					book settingsAt: (value at: 1) put: test.					((value at: 3) = test) ifFalse: [(value at: 5)						ifNotNil: [(addresses includes: (value at: 5))							ifFalse: [addresses add: (value at: 5)]]]]]			ifFalse: [(request fieldsAsBooleanKey: ('inherit-', (value at: 1)))				ifFalse: ["Change to Request Value"					((value at: 3) isKindOf: String)						ifTrue: [test _ request fieldsKey: (value at: 1)]						ifFalse: [test _ request fieldsAsBooleanKey: (value at: 1)].					book settingsAt: (value at: 1) put: test.					(value at: 5)						ifNotNil: [(addresses includes: (value at: 5))							ifFalse: [addresses add: (value at: 5)]]]]]		ifFalse: [			((value at: 3) isKindOf: String)				ifTrue: [test _ request fieldsKey: (value at: 1)]				ifFalse: [test _ request fieldsAsBooleanKey: (value at: 1)].			book settingsAt: (value at: 1) put: test.			((value at: 3) = test) ifFalse: [(value at: 5)				ifNotNil: [(addresses includes: (value at: 5))					ifFalse: [addresses add: (value at: 5)]]]]]]."Do Addresses"addresses do: [:address | book formatPrivAddress: address request: request response: response shelf: shelf]."Store Changes"book	writeSettings;	permitWriting."Return Forward to Settings"response	at: 'headerStatus' put: #tempMoved;	at: 'location' put: (request referenceShelf: shelf address: ('admin/settings?book=', book name)).shelf formatShelfTemplate: 'location' request: request response: response