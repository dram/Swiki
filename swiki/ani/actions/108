| groups users members check |groups _ book groups.groups isEmpty	ifTrue: ['no current groups<br>']	ifFalse: [String streamContents: [:stream |		"Organize groups, based on their names"		groups _ groups asSortedCollection: [:a :b | a name asLowercase < b name asLowercase].		users _ (shelf modulesAt: 'users') users.		stream			nextPutAll: '<form action="';			nextPutAll: (request referenceShelf: shelf book: book address: 'updateGroups');			nextPutAll: '" method=post>';			nextPutAll: String crlf;			nextPutAll: '<table border=0 cellpadding=2 cellspacing=0>';			nextPutAll: String crlf.		groups do: [:group |			stream				nextPutAll: '<tr><td class="header"><b><input type="text" size=10 name="name';				nextPutAll: group showId;				nextPutAll: '" value="';				nextPutAll: group showStrictName;				nextPutAll: '"></b></td><td class="header" align=right>delete:&nbsp;<input type="checkbox" name="delete';				nextPutAll: group showId;				nextPutAll: '" value="true"></td></tr>';				nextPutAll: String crlf;				nextPutAll: '<tr><td class="row1" valign=top>Be Signed-in:</td><td class="row1"><input type="radio" name="beSignedIn';				nextPutAll: group showId;				nextPutAll: '" value="true"'.			group beSignedIn ifTrue: [stream				nextPutAll: ' checked'].			stream				nextPutAll: '> group members must be signed in<br><input type="radio" name="beSignedIn';				nextPutAll: group showId;				nextPutAll: '" value="false"'.			group beSignedIn ifFalse: [stream				nextPutAll: ' checked'].			stream				nextPutAll: '> group members can be anonymous</td></tr>';				nextPutAll: String crlf;				nextPutAll: '<tr><td class="row2">Password:</td><td class="row2"><input type="password" size=15 name="password';				nextPutAll: group showId;				nextPutAll: '" value="';				nextPutAll: group showStrictPassword;				nextPutAll: '"></td></tr>';				nextPutAll: String crlf;				nextPutAll: '<tr><td class="row1" valign=top>IP&nbsp;Addresses:<br>(ipNumber/ipMask)</td><td class="row1"><textarea name="addresses';				nextPutAll: group showId;				nextPutAll: '" rows=2 cols=35 wrap=virtual>';				nextPutAll: group showIPs;				nextPutAll: '</textarea></td></tr>';				nextPutAll: String crlf;				nextPutAll: '<tr><td class="row2" valign=top>Members:<br>(by&nbsp;e-mail&nbsp;address)</td><td class="row2"><textarea name="members';				nextPutAll: group showId;				nextPutAll: '" rows=4 cols=35 wrap=virtual>'.			members _ Set new.			check _ book name, '-', group showId.			users do: [:user | (user settingsIncludes: check) ifTrue: [				members add: user address]].			members _ members asSortedCollection: [:a :b | a asLowercase < b asLowercase].			members do: [:address | stream				nextPutAll: (TextFormatter encodeToXmlCrlf: address);				nextPutAll: String crlf].			stream				nextPutAll: '</textarea></td></tr>';				nextPutAll: String crlf			].		stream			nextPutAll: '<tr><td class="header" colspan=2><input type="submit" value="update"></td></tr>';			nextPutAll: String crlf;			nextPutAll: '</table>';			nextPutAll: String crlf;			nextPutAll: '</form>';			nextPutAll: String crlf]]