"upload images to make a gallery page	OPTIONAL	times = the number of uploads to do	width = the maximum width of the inlined image	height = the maximum height of the inlined image	space = space around it	border = border size"| options error times bgColor id |options _ request settingsAt: 'options'.error _ nil."Check to see that the person is allowed to upload"((page accessLevelForRequest: request) > 3) ifFalse: [	"if not, don't give them the option"	error _ ''].error ifNil: ["Get times"	times _ options at: 'times' ifAbsent: ['1'].	times isAllDigits		ifTrue: [times _ times asInteger.			((times > 0) and: [times < 11]) ifFalse: [				error _ '<b>GALLERY function''s <em>times</em> field must be 10 or less.</b>']]		ifFalse: [error _ '<b>GALLERY function''s <em>times</em> field must be an integer.</b>']].error	ifNil: [String streamContents: [:stream |		stream			nextPutAll: '<form action="';			nextPutAll: (request referenceShelf: shelf book: book page: page address: 'attachImage');			nextPutAll: '" method="post" enctype="multipart/form-data">';			nextPutAll: String crlf;			nextPutAll: '<table border=0 cellpadding=2 cellspacing=0>';			nextPutAll: String crlf;			nextPutAll: '<tr><td class="header"><b>Image</b> (png, gif, jpeg)</td><td class="header" align=right><b>ALT Text</b></td></tr>';			nextPutAll: String crlf.		bgColor _ 'row1'.		1 to: times do: [:i |			stream				nextPutAll: '<tr><td class="';				nextPutAll: bgColor;				nextPutAll: '"><input type="file" name="file';				nextPutAll: i asString;				nextPutAll: '"></td><td class="';				nextPutAll: bgColor;				nextPutAll: '"><input type="text" size=25 name="alt';				nextPutAll: i asString;				nextPutAll: '"></td></tr>';				nextPutAll: String crlf.			bgColor _ (bgColor = 'row1') ifTrue: ['row2'] ifFalse: ['row1']].		stream			nextPutAll: '<tr><td class="header" colspan=2><input type="submit" value="upload"></td></tr>';			nextPutAll: String crlf;			nextPutAll: '</table>';			nextPutAll: String crlf.		"Put in options"		(options includesKey: 'width') ifTrue: [stream			nextPutAll: '<input type="hidden" name="width" value="';			nextPutAll: (options at: 'width');			nextPutAll: '">';			nextPutAll: String crlf].		(options includesKey: 'height') ifTrue: [stream			nextPutAll: '<input type="hidden" name="height" value="';			nextPutAll: (options at: 'height');			nextPutAll: '">';			nextPutAll: String crlf].		(options includesKey: 'space') ifTrue: [stream			nextPutAll: '<input type="hidden" name="space" value="';			nextPutAll: (options at: 'space');			nextPutAll: '">';			nextPutAll: String crlf].		(options includesKey: 'border') ifTrue: [stream			nextPutAll: '<input type="hidden" name="border" value="';			nextPutAll: (options at: 'border');			nextPutAll: '">';			nextPutAll: String crlf].		"Identify the ID of this gallery"		id _ request settingsAt: 'galleryId' ifAbsent: [0].		id _ id + 1.		request settingsAt: 'galleryId' put: id.		stream			nextPutAll: '<input type="hidden" name="id" value="';			nextPutAll: id asString;			nextPutAll: '">';			nextPutAll: String crlf;			nextPutAll: '</form>']]	ifNotNil: [error]