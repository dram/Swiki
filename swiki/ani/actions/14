| dir prefix versions img ref return bgColor |dir _ request settingsAt: 'dir'.prefix _ book settingsAt: 'uploadServerPath'.versions _ (request settingsAt: 'file') versions.return _ WriteStream on: String new."Add a link to progression if an image"versions isAnImage ifTrue: [return	nextPutAll: '<a href="';	nextPutAll: (request referenceShelf: shelf book: book address: 'uploads/');	nextPutAll: dir httpPath;	nextPutAll: versions first httpName;	nextPutAll: '?history=true&amp;show=true">View all versions of this image.</a><br><br>';	nextPutAll: String crlf].return	nextPutAll: '<table border=0 cellpadding=2 cellspacing=0>';	nextPutAll: String crlf;	nextPutAll: '<tr><td class="header">&nbsp;</td><td class="header"><b>Name</b></td><td class="header" align=right>&nbsp;&nbsp;<b>Size</b></td><td class="header" align=right>&nbsp;&nbsp;<b>Date</b></td></tr>';	nextPutAll: String crlf.img _ (book modulesAt: 'colorScheme') mime: (versions mimeType copyUpTo: $/) alt: versions strictXmlName.bgColor _ 'row1'.versions do: [:entry |	ref _ prefix, dir httpPath, entry httpName.	return		nextPutAll: '<tr><td class="';		nextPutAll: bgColor;		nextPutAll: '"><a href="';		nextPutAll: ref;		nextPutAll: '">';		nextPutAll: img;		nextPutAll: '</a></td><td class="';		nextPutAll: bgColor;		nextPutAll: '"><a href="';		nextPutAll: ref;		nextPutAll: '">';		nextPutAll: entry xmlName;		nextPutAll: '</a></td><td class="';		nextPutAll: bgColor;		nextPutAll: '" align=right>&nbsp;&nbsp;';		nextPutAll: entry fileSizeInWords;		nextPutAll: '</td><td class="';		nextPutAll: bgColor;		nextPutAll: '" align=right>&nbsp;&nbsp;';		nextPutAll: (NuSwikiPage printDate: entry modificationDate);		nextPutAll: '</td></tr>';		nextPutAll: String crlf.	bgColor _ (bgColor = 'row1') ifTrue: ['row2'] ifFalse: ['row1']].return	nextPutAll: '</table>';	contents