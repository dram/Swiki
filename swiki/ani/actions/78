| sumVotes maxVotes votes return bgColor toFiles length survey |survey _ request settingsAt: 'survey'."Get maxVotes and sumVotes"sumVotes _ survey sumVotes.maxVotes _ survey maxVotes.return _ WriteStream on: String new."Header Row"return	nextPutAll: '<table border=0 cellpadding=0 cellspacing=0>';	nextPutAll: String crlf;	nextPutAll: '<tr><td class="header">&nbsp;</td><td class="header" align=center>&nbsp;<b>#</b>&nbsp;</td><td class="header"><b>Percentage</b></td></tr>';	nextPutAll: String crlf."Add Rows"bgColor _ 'row1'.toFiles _ book formatBookAction: 'toFiles' request: request response: response shelf: shelf.survey results do: [:arr |	votes _ arr at: 2.	length _ (maxVotes = 0)		ifTrue: [0]		ifFalse: [200 * votes // maxVotes].	return		nextPutAll: '<tr><td class="';		nextPutAll: bgColor;		nextPutAll: '" align=right>&nbsp;<b>';		nextPutAll: (TextFormatter encodeToXmlCrlf: (arr at: 1));		nextPutAll: '</b></td><td class="';		nextPutAll: bgColor;		nextPutAll: '" align=right>&nbsp;';		nextPutAll: votes asString;		nextPutAll: '&nbsp;</td><td class="';		nextPutAll: bgColor;		nextPutAll: 'Graph">'.	(length = 0)		ifTrue: [return nextPutAll: '&nbsp;0.0&nbsp;%']		ifFalse: [			return				nextPutAll: '<img src="';				nextPutAll: toFiles;				nextPutAll: 'graphbar.gif" alt="-'.			(length // 30) timesRepeat: [return				nextPut: $-].			return				nextPutAll: '" width=';			nextPutAll: length asString;			nextPutAll: ' height=5 border=1>&nbsp;';			nextPutAll: ((1000 * votes asFloat / sumVotes) asInteger asFloat / 10) asString;			nextPutAll: '&nbsp;%'].	return		nextPutAll: '</td></tr>';		nextPutAll: String crlf.	bgColor _ (bgColor = 'row1') ifTrue: ['row2'] ifFalse: ['row1']].return	nextPutAll: '<tr><td class="header" align=right>&nbsp;Total</td><td class="header" align=right>&nbsp;';	nextPutAll: sumVotes asString;	nextPutAll: '&nbsp;</td>'.survey hasRange	ifTrue: [return		nextPutAll: '<td class="header" align=right>&nbsp;Average&nbsp;';		nextPutAll: survey averageString]	ifFalse: [return		nextPutAll: '<td class="header">'].return	nextPutAll: '&nbsp;</td></tr>';	nextPutAll: String crlf;	nextPutAll: '</table>';	contents