| address select message error |address _ request fieldsKey: 'address'.select _ (shelf modulesAt: 'users') usersWithAddress: address.select isEmpty	ifTrue: [book formatBookTemplate: 'remindFailedNoUsers' request: request response: response shelf: shelf]	ifFalse: [		message _ WriteStream on: String new.		message nextPutAll: (book formatBookTemplate: 'remindBefore' request: request response: response shelf: shelf).		select do: [:i |			request settingsAt: 'username' put: i name.			request settingsAt: 'password' put: i password.			message nextPutAll: (book formatBookTemplate: 'remindAccount' request: request response: response shelf: shelf)].		error _ false.		message _ TextFormatter crlfToCr: message contents.		[SMTPClient deliverMailFrom: (book settingsAt: 'alertSender') to: (OrderedCollection with: address) text: message usingServer: (book settingsAt: 'alertServer')] ifError: [:a :b | error _ true].		error			ifTrue: [book formatBookTemplate: 'remindFailedEmail' request: request response: response shelf: shelf]			ifFalse: [book formatBookTemplate: 'remindSuccess' request: request response: response shelf: shelf]]