"Get Access by either password or logging in"| error key passwords groups |error _ nil.(request security isNil and: [(request fieldsKey: 'user' ifAbsent: ['']) isEmpty not]) ifTrue: [	"Try to sign in"	(shelf modulesAt: 'users') signInRequest: request.	request security		ifNil: [error _ book formatBookTemplate: 'signInFailed' request: request response: response shelf: shelf]		ifNotNil: ["Add current cookies to signed-in"			book formatPrivAddress: 'addGroupsToUser' request: request response: response shelf: shelf]].error ifNil: [	key _ request fieldsKey: 'key' ifAbsent: [''].	key isEmpty ifFalse: [		"Check to make sure the key is useful"		groups _ (book modulesAt: 'groups') groupsWithPassword: key.		groups isEmpty			ifTrue: [error _ book formatBookTemplate: 'getAccessFailed' request: request response: response shelf: shelf]			ifFalse: [request security				ifNil: ["Add key to cookie passwords"					passwords _ request settingsAt: 'passwords' ifAbsent: [OrderedCollection new].					passwords add: key.					request setCookiePasswords: passwords]				ifNotNil: ["Add groups to user account"					groups do: [:group | request security						settingsAt: (book name, '-', group showId) put: true].					request security save]]]].error	ifNil: ["Successful"		response at: 'headerStatus' put: #tempMoved.		response at: 'location' put: (request fieldsKey: 'forwardURL' ifAbsent: [request referenceShelf: shelf book: book]).		book formatBookTemplate: 'getAccessSuccess' request: request response: response shelf: shelf]	ifNotNil: [error]