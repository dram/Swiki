"Serve uploads of the form /swikiname/uploads/"| uploadPath path |uploadPath _ request referenceShelf: shelf book: book address: 'uploads'.path _ request raw url.(path = uploadPath)	ifTrue: ["redirect to /swikiname/uploads/"		response			at: 'headerStatus' put: #tempMoved;			at: 'location' put: (uploadPath, '/').		shelf formatShelfTemplate: 'toDir' request: request response: response]	ifFalse: [((path at: (uploadPath size + 1)) = $/)		ifTrue: [((path size) = (uploadPath size + 1))			ifTrue: [(book modulesAt: 'uploads') serveDirFs: (book modulesAt: 'uploadServer') options: (Dictionary new at: 'request' put: request; at: 'response' put: response; yourself)]			ifFalse: [(request fieldsAsBooleanKey: 'history' ifAbsent: [false])				ifTrue: [(book modulesAt: 'uploads') servePath: (path copyFrom: (uploadPath size + 2) to: path size) fs: (book modulesAt: 'uploadHistoryServer') options: (Dictionary new at: 'request' put: request; at: 'response' put: response; yourself)]				ifFalse: [(book modulesAt: 'uploads') servePath: (path copyFrom: (uploadPath size + 2) to: path size) fs: (book modulesAt: 'uploadServer') options: (Dictionary new at: 'request' put: request; at: 'response' put: response; yourself)]]]		ifFalse: [			response at: 'headerStatus' put: #notFound.			book formatBookTemplate: 'addressNotFound' request: request response: response shelf: shelf]]